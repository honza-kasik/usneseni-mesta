= Parsování usnesení města Litovel
:toc:
:toclevels: 2

Pipeline pro deterministické zpracování usnesení Rady a Zastupitelstva města Litovel.

Cílem je:

- převod PDF do strukturované podoby,
- extrakce struktury usnesení,
- resolvování vzájemných referencí,
- vytvoření fulltextového indexu,
- maximální reprodukovatelnost a auditovatelnost.

Každá fáze je samostatný skript.
Jedno usnesení = jeden JSON soubor.

== Architektura

Pipeline má čtyři fáze:

[cols="1,3"]
|===
|Phase 1
|Parsování PDF → základní JSON

|Phase 2
|Strukturální analýza usnesení

|Phase 3
|Resolvování referencí mezi usneseními

|Phase 4
|Vytvoření fulltextového indexu
|===

== Phase 1 – Parsování PDF

Parsování PDF s usneseními Rady nebo Zastupitelstva města Litovel.

=== Vstup

- jeden PDF soubor  
- NEBO složka s PDF soubory  

=== Výstup

- jeden JSON soubor = jedno usnesení  

=== Použití

[source,bash]
----
python phase1_parse_pdf.py input.pdf output_dir/
python phase1_parse_pdf.py pdf_dir/ output_dir/
----

== Phase 2 – Analýza syrového textu usnesení

Zpracuje JSON z Phase 1.

=== Vstupní struktura

[source,json]
----
{
  "id": "RM/1/1/2022",
  "datum": "2022-10-27",
  "organ": "Rada města Litovel",
  "text_raw": "text_usneseni"
}
----

=== Výstupní struktura

[source,json]
----
{
  "id": "RM/1/1/2022",
  "datum": "2022-10-27",
  "organ": "Rada města Litovel",
  "actions": [
    "schvaluje",
    "souhlasí"
  ],
  "subject": null,
  "items": [
    {
      "label": "a",
      "text": "text_1"
    },
    {
      "label": "b",
      "text": "text_2"
    }
  ],
  "tail": null,
  "references_out": [],
  "amounts": [
    "10.000 Kč"
  ]
}
----

=== Co fáze dělá

- extrahuje akce (např. „schvaluje“, „bere na vědomí“),
- rozděluje vícepoložková usnesení na jednotlivé body,
- odděluje `subject` (text před body) a `tail` (text za body),
- extrahuje peněžní částky,
- hrubě extrahuje reference (bez resolvování).

=== Použití

[source,bash]
----
python phase2_resolution_analysis.py --input phase1_dir/ --output phase2_dir/
----

== Phase 3 – Resolvování referencí

Usnesení mohou odkazovat jedno na druhé.

V této fázi se resolvují reference:

- implicitní  
  např. `1853/60` → `RM/1853/60/2025`
- explicitní  
  např. `RM/1853/60/2025`

Resolvované reference:

- jsou doplněny do nového klíče `references_in`,
- vztah je oboustranný.

Na závěr jsou vypsány statistiky do konzole.

=== Vstup

- adresář s JSON soubory ze Phase 2

=== Výstup

- jeden JSON soubor = jedno usnesení

=== Použití

[source,bash]
----
python phase3_resolve_references.py --input phase2_dir/ --output phase3_dir/
----

== Phase 4 – Vytvoření indexu

Vytvoří index pro fulltextové vyhledávání.

=== Vstup

- adresář s JSON soubory ze Phase 3

=== Výstupní struktura

- `index/`  
  - jeden JSON soubor = jeden rok (fulltextový index)

- `data/`  
  - jeden JSON soubor = jeden rok (usnesení)

- `meta.json`  
  - statistická metadata (např. počty rozhodnutí za roky)

=== Použití

[source,bash]
----
python phase4_index_build.py --input phase3_dir/ --output phase4_dir/
----

== Principy návrhu

- Jedno usnesení = jeden JSON soubor.
- Žádná interpretace obsahu.
- Deterministické zpracování.
- Každá fáze je spustitelná samostatně.
- Vše je rekonstruovatelné z původních PDF.

== Poznámky

Pipeline je navržena pro dlouhodobou udržitelnost a auditovatelnost.
Nevykonává právní interpretaci ani hodnotící analýzu obsahu.
